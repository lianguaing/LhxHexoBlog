<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>vue项目-问题解决01 | Luax的博客</title><meta name="author" content="hx桦"><meta name="copyright" content="hx桦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="项目笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="vue项目-问题解决01">
<meta property="og:url" content="https://lianguaing.github.io/2024/02/20/vue3%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="Luax的博客">
<meta property="og:description" content="项目笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/14.jpg">
<meta property="article:published_time" content="2024-02-19T16:00:00.000Z">
<meta property="article:modified_time" content="2024-03-17T03:35:42.677Z">
<meta property="article:author" content="hx桦">
<meta property="article:tag" content="项目笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/14.jpg"><link rel="shortcut icon" href="/img/fav1.png"><link rel="canonical" href="https://lianguaing.github.io/2024/02/20/vue3%E9%A1%B9%E7%9B%AE/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'vue项目-问题解决01',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-17 11:35:42'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/14.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Luax的博客"><span class="site-name">Luax的博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">vue项目-问题解决01</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-02-19T16:00:00.000Z" title="发表于 2024-02-20 00:00:00">2024-02-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-17T03:35:42.677Z" title="更新于 2024-03-17 11:35:42">2024-03-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/vue/">vue</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/vue/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/">项目笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>20分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="vue项目-问题解决01"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="vue项目"><a href="#vue项目" class="headerlink" title="vue项目"></a>vue项目</h1><h2 id="组件分类"><a href="#组件分类" class="headerlink" title="组件分类"></a>组件分类</h2><p>通用型组件（ElementPlus）-Dialog模态框</p>
<p>业务定制化组件&#x3D;商品热榜组件</p>
<h2 id="主题色定制-sass引入"><a href="#主题色定制-sass引入" class="headerlink" title="主题色定制-sass引入"></a>主题色定制-sass引入</h2><p>安装sass</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i sass -D</span><br></pre></td></tr></table></figure>

<h2 id="axios实例化配置"><a href="#axios实例化配置" class="headerlink" title="axios实例化配置"></a>axios实例化配置</h2><p>使用实例化的 Axios 对象后，在发起请求时不需要再写完整的 URL。当使用实例化对象发起请求时，实例的 <code>baseURL</code> 会作为请求的基础 URL，而只需要提供相对路径即可。</p>
<p>比如，如果创建了一个实例 <code>instance</code>，设置了 <code>baseURL</code> 为 <code>&#39;https://api.example.com&#39;</code>，那么在使用这个实例发起请求时，只需要提供相对路径：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">javascriptCopy code</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">const</span> instance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;https://api.example.com&#x27;</span>,</span><br><span class="line">  <span class="comment">// 其他配置...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用实例发起请求</span></span><br><span class="line">instance.<span class="title function_">get</span>(<span class="string">&#x27;/users&#x27;</span>) <span class="comment">// 实际请求的URL为 &#x27;https://api.example.com/users&#x27;</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>这种方式使得代码更加简洁，同时提高了代码的可维护性。全局的 <code>axios</code> 对象需要在每次请求时提供完整的 URL，而实例化的对象可以通过设置 <code>baseURL</code> 来减少在每个请求中写重复的 URL 部分。</p>
<h2 id="吸顶交互"><a href="#吸顶交互" class="headerlink" title="吸顶交互"></a>吸顶交互</h2><p>安装vueUse插件</p>
<p>引用useScroll函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="comment">// vueUse</span></span><br><span class="line"><span class="keyword">import</span> &#123; useScroll &#125; <span class="keyword">from</span> <span class="string">&quot;@vueuse/core&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; y &#125; = <span class="title function_">useScroll</span>(<span class="variable language_">window</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>样式嵌套：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.<span class="property">app</span>-header-sticky &#123;</span><br><span class="line">  <span class="attr">width</span>: <span class="number">100</span>%;</span><br><span class="line">  <span class="attr">height</span>: 80px;</span><br><span class="line">  <span class="attr">position</span>: fixed;</span><br><span class="line">  <span class="attr">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attr">top</span>: <span class="number">0</span>;</span><br><span class="line">  z-<span class="attr">index</span>: <span class="number">999</span>;</span><br><span class="line">  background-<span class="attr">color</span>: #fff;</span><br><span class="line">  border-<span class="attr">bottom</span>: 1px solid #e4e4e4;</span><br><span class="line">  <span class="comment">// 此处为关键样式!!!</span></span><br><span class="line">  <span class="comment">// 状态一：往上平移自身高度 + 完全透明</span></span><br><span class="line">  <span class="attr">transform</span>: <span class="title function_">translateY</span>(-<span class="number">100</span>%);</span><br><span class="line">  <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 状态二：移除平移 + 完全不透明</span></span><br><span class="line">  &amp;.<span class="property">show</span> &#123;</span><br><span class="line">    <span class="attr">transition</span>: all <span class="number">0.</span>3s linear;</span><br><span class="line">    <span class="attr">transform</span>: none;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;   </span><br><span class="line">  ...</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;app-header-sticky&quot;</span> :<span class="keyword">class</span>=<span class="string">&quot;&#123; show: y &gt; 78 &#125;&quot;</span>&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>因为两个组件都需要请求接口数据，如何优化？</p>
<h2 id="Pinia优化重复请求"><a href="#Pinia优化重复请求" class="headerlink" title="Pinia优化重复请求"></a>Pinia优化重复请求</h2><p>在store文件夹里面新建category.js文件用来管理和共享分类接口的数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getCategoryAPI &#125; <span class="keyword">from</span> <span class="string">&#x27;@/apis/layout&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCategoryStore = <span class="title function_">defineStore</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">categoryList</span>: [],</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getCategory</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getCategoryAPI</span>()</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">categoryList</span> = res.<span class="property">result</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取分类出错：&#x27;</span>, error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>组件如何调用？</p>
<p>方法一：父组件调用异步请求action方法，子组件分别调用state数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//子组件调用：</span></span><br><span class="line"><span class="keyword">import</span> &#123; useCategoryStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/stores/category&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> categoryStore = <span class="title function_">useCategoryStore</span>();</span><br><span class="line"></span><br><span class="line">***</span><br><span class="line">...</span><br><span class="line">     &lt;ul <span class="keyword">class</span>=<span class="string">&quot;app-header-nav&quot;</span>&gt;</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">class</span>=<span class="string">&quot;home&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">v-for</span>=<span class="string">&quot;item in categoryStore.categoryList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="组件封装-数据传输问题"><a href="#组件封装-数据传输问题" class="headerlink" title="组件封装(数据传输问题)"></a>组件封装(数据传输问题)</h2><p>把可复用的结构只写一次，把可能发送变化的部分抽象成组件参数（props&#x2F;插槽）</p>
<p>逻辑拆分与组件封装的模块化优化，使用动态参数传递机制实现数据和结构的分离，提高了代码的可维护性和可拓展性；</p>
<p>如goodsitem组件封装</p>
<p>调用复用组件的组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">GoodsItem</span> <span class="keyword">from</span> <span class="string">&quot;./GoodsItrm.vue&quot;</span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;goods-list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;good in cate.goods&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;good.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">GoodsItem</span> <span class="attr">:goods</span>=<span class="string">&quot;good&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>组装的复用组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">goods</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span> <span class="attr">class</span>=<span class="string">&quot;goods-item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-img-lazy</span>=<span class="string">&quot;goods.picture&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;name ellipsis&quot;</span>&gt;</span>&#123;&#123; goods.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;desc ellipsis&quot;</span>&gt;</span>&#123;&#123; goods.desc &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span><span class="symbol">&amp;yen;</span>&#123;&#123; goods.price &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="实现图片懒加载"><a href="#实现图片懒加载" class="headerlink" title="实现图片懒加载"></a>实现图片懒加载</h2><p>1、全局指令定义</p>
<p>2、调用vueUse的useIntersectionObserver函数:判断图片是否进入视图区域</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useIntersectionObserver &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="comment">//定义全局指令</span></span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;img-lazy&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(el, binding);</span><br><span class="line">    <span class="title function_">useIntersectionObserver</span>(</span><br><span class="line">      el,</span><br><span class="line">      <span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(isIntersecting);</span><br><span class="line">        <span class="comment">//图片进入视图区域发送请求</span></span><br><span class="line">        <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">          el.<span class="property">src</span> = binding.<span class="property">value</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//img标签使用指令</span></span><br><span class="line">&lt;img v-img-lazy=<span class="string">&quot;item.picture&quot;</span> alt=<span class="string">&quot;&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="懒加载优化"><a href="#懒加载优化" class="headerlink" title="懒加载优化"></a>懒加载优化</h2><p>问题一：逻辑书写位置不合理，复杂度转移</p>
<p>前面是将代码写到了入口文件main.js，这样写会增加main.js的复杂度，不妨将懒加载指令封装成插件，入口文件只需要负责注册插件即可</p>
<p>创建插件文件夹，index.js文件中写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义懒加载插件</span></span><br><span class="line"><span class="keyword">import</span> &#123; useIntersectionObserver &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> lazyPlugin = &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    app.<span class="title function_">directive</span>(<span class="string">&#x27;img-lazy&#x27;</span>, &#123;</span><br><span class="line">      <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(el, binding);</span><br><span class="line">        <span class="title function_">useIntersectionObserver</span>(</span><br><span class="line">          el,</span><br><span class="line">          <span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(isIntersecting);</span><br><span class="line">            <span class="comment">//图片进入视图区域发送请求</span></span><br><span class="line">            <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">              el.<span class="property">src</span> = binding.<span class="property">value</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>入口文件注册：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入懒加载指令插件并且注册</span></span><br><span class="line"><span class="keyword">import</span> &#123;lazyPlugin&#125; <span class="keyword">from</span> <span class="string">&#x27;@/directives&#x27;</span></span><br><span class="line">app.<span class="title function_">use</span>(lazyPlugin)</span><br></pre></td></tr></table></figure>

<p>问题二：useIntersectionObserver重复监听</p>
<p>增加stop函数，第一次图片加载完毕后调用stop函数停止监听，防止内存浪费</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; stop &#125; = <span class="title function_">useIntersectionObserver</span>(</span><br><span class="line">  el,</span><br><span class="line">  <span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(isIntersecting);</span></span><br><span class="line">    <span class="comment">//图片进入视图区域发送请求</span></span><br><span class="line">    <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">      el.<span class="property">src</span> = binding.<span class="property">value</span></span><br><span class="line">      <span class="title function_">stop</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="主页一级分类"><a href="#主页一级分类" class="headerlink" title="主页一级分类"></a>主页一级分类</h2><p>思路：准备组件模板-&gt;封装接口函数-&gt;调用接口获取数据（使用路由参数）-&gt;渲染模板</p>
<h2 id="路由缓存问题"><a href="#路由缓存问题" class="headerlink" title="路由缓存问题"></a>路由缓存问题</h2><p>使用带有参数的路由需要注意的是，当用户从&#x2F;users&#x2F;id1导航到&#x2F;users&#x2F;id2时，相同的组件实例将被重复使用。因为两个路由都渲染同个组件，比起销毁再创建，复用则显得更加高效。不过，这也意味着组件的生命周期钩子不会被调用。</p>
<p>如何解决问题？</p>
<p>思路1：让组件实例不再复用，强制销毁重建；</p>
<p>思路2：监听路由变化，变化之后执行数据更新操作；</p>
<h3 id="方案一：给router-view添加key"><a href="#方案一：给router-view添加key" class="headerlink" title="方案一：给router-view添加key"></a>方案一：给router-view添加key</h3><p>以当前路由完整路径为key的值，给router-view组件绑定</p>
<p>为什么用key？我们最常见的用例是与v-for结合，但是key也可以用于强制替换一个元素&#x2F;组件而不是复用它。</p>
<ul>
<li>在适当的时候触发组件的生命周期钩子</li>
<li>触发过渡</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">RouterView</span> :key=<span class="string">&quot;$route.fullPath&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>但是这种方法也存在问题，过于粗暴，如果每次导航都销毁组件重建，说明每次导航都要重新发送一次数据请求，如果有相同数据，则存在浪费。那怎么做到只发送需要的数据请求呢？</p>
<h3 id="方案二：使用beforeRouterUpdate导航钩子"><a href="#方案二：使用beforeRouterUpdate导航钩子" class="headerlink" title="方案二：使用beforeRouterUpdate导航钩子"></a>方案二：使用beforeRouterUpdate导航钩子</h3><p>该钩子函数可以在每次路由更新之前执行，在回调中执行需要数据更新的业务逻辑即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onBeforeRouteUpdate, useRoute &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> route = <span class="title function_">useRoute</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getCategory</span> = <span class="keyword">async</span> (<span class="params">id = route.params.id</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 如何在setup中获取路由参数 useRoute() -&gt; route 等价于this.$route</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getTopCategoryAPI</span>(id);</span><br><span class="line">  categoryData.<span class="property">value</span> = res.<span class="property">result</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> <span class="title function_">getCategory</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">//目标：路由参数变化的时候，可以把分类数据接口重新发送</span></span><br><span class="line"><span class="title function_">onBeforeRouteUpdate</span>(<span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(to);</span><br><span class="line">  <span class="title function_">getCategory</span>(to.<span class="property">params</span>.<span class="property">id</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>useRoute</code> 用于在 Vue 3 中访问当前路由对象。它返回一个包含当前路由信息的对象，类似于 <code>this.$route</code> 在 Vue 2 中的用法。它返回一个响应式的路由对象，包含了当前路由的各种信息，例如 <code>path</code>、<code>params</code>、<code>query</code> ，这里是使用当前路由对象的params的id。</p>
<p>在 Vue Router 中，<code>onBeforeRouteUpdate</code> 是一个导航守卫，它会在当前路由更新但是同一组件被复用时被调用。这个守卫的回调函数接受一个 <code>to</code> 参数，它表示即将导航到的目标路由对象。</p>
<p>其中 <code>to.params.id</code> 表示即将导航到的路由的 <code>id</code> 参数。</p>
<p>这部分代码涉及到 Vue Router 的<strong>路由导航守卫</strong>，具体是 <code>onBeforeRouteUpdate</code> 钩子函数的使用。这个函数在路由参数发生变化时被调用，允许你在组件复用时对路由参数的变化做出响应。在这里，你使用了该函数来重新获取分类数据接口，以确保在路由参数变化时，相应的分类数据会被重新加载。</p>
<p>这点的亮点在于<strong>实现了在路由参数变化时动态更新相关数据</strong>，为用户提供了更流畅的页面切换体验，同时也是在合理利用 Vue Router 提供的路由导航守卫进行数据预加载。</p>
<h2 id="逻辑拆分"><a href="#逻辑拆分" class="headerlink" title="逻辑拆分"></a>逻辑拆分</h2><p>将独立的业务逻辑拆分出去再组合的过程</p>
<p>比如将请求分类和请求轮播图数据的业务拆分封装到独立的js文件中，函数use打头，内部封装逻辑便于后期维护，return组件需要用到的数据和方法给组件消费。</p>
<p>组件：.vue文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCategory &#125; <span class="keyword">from</span> <span class="string">&quot;./composables/useCategory&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useBanner &#125; <span class="keyword">from</span> <span class="string">&quot;./composables/useBanner&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; categoryData &#125; = <span class="title function_">useCategory</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; bannerList &#125; = <span class="title function_">useBanner</span>();</span><br></pre></td></tr></table></figure>

<p>内部封装函数：.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装banner轮播图相关的业务代码</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getBannerAPI &#125; <span class="keyword">from</span> <span class="string">&#x27;@/apis/home&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useBanner</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> bannerList = <span class="title function_">ref</span>([])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getBanner</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getBannerAPI</span>(&#123;</span><br><span class="line">      <span class="attr">distributionSite</span>: <span class="string">&#x27;2&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    bannerList.<span class="property">value</span> = res.<span class="property">result</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> <span class="title function_">getBanner</span>())</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    bannerList</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>useCategory.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装分类数据业务相关代码</span></span><br><span class="line"><span class="keyword">import</span> &#123; onMounted, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getTopCategoryAPI &#125; <span class="keyword">from</span> <span class="string">&quot;@/apis/category&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRoute &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; onBeforeRouteUpdate &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useCategory</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> categoryData = <span class="title function_">ref</span>(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> route = <span class="title function_">useRoute</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getCategory</span> = <span class="keyword">async</span> (<span class="params">id = route.params.id</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 如何在setup中获取路由参数 useRoute() -&gt; route 等价于this.$route</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getTopCategoryAPI</span>(id);</span><br><span class="line">    categoryData.<span class="property">value</span> = res.<span class="property">result</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> <span class="title function_">getCategory</span>());</span><br><span class="line"></span><br><span class="line">  <span class="comment">//目标：路由参数变化的时候，可以把分类数据接口重新发送</span></span><br><span class="line">  <span class="title function_">onBeforeRouteUpdate</span>(<span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(to);</span><br><span class="line">    <span class="title function_">getCategory</span>(to.<span class="property">params</span>.<span class="property">id</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    categoryData</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="列表无限加载功能实现"><a href="#列表无限加载功能实现" class="headerlink" title="列表无限加载功能实现"></a>列表无限加载功能实现</h2><p>获取二级分类商品列表的接口：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 获取导航数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> &#123;<span class="type"> </span></span></span><br><span class="line"><span class="type"><span class="comment">     categoryId: 1005000 ,</span></span></span><br><span class="line"><span class="type"><span class="comment">     page: 1,</span></span></span><br><span class="line"><span class="type"><span class="comment">     pageSize: 20,</span></span></span><br><span class="line"><span class="type"><span class="comment">     sortField: &#x27;publishTime&#x27; | &#x27;orderNum&#x27; | &#x27;evaluateNum&#x27;</span></span></span><br><span class="line"><span class="type"><span class="comment">   </span>&#125; </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">*</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getSubCategoryAPI</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/category/goods/temporary&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>组件调用接口，获取基本数据列表：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取基本数据列表</span></span><br><span class="line"><span class="keyword">const</span> goodList = <span class="title function_">ref</span>([]);</span><br><span class="line"><span class="keyword">const</span> repData = <span class="title function_">ref</span>(&#123;</span><br><span class="line">  <span class="attr">categoryId</span>: route.<span class="property">params</span>.<span class="property">id</span>,</span><br><span class="line">  <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">pageSize</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">sortField</span>: <span class="string">&quot;publishTime&quot;</span>,<span class="comment">//这里双向绑定组件的值</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>获取并加载商品列表：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getGoodList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span>      <span class="title function_">getSubCategoryAPI</span>(repData.<span class="property">value</span>);</span><br><span class="line"> <span class="comment">//调用接口传入repData参数获取商品分类数据</span></span><br><span class="line">  <span class="comment">//赋值，goodList响应式数据发生变化，组件会重新渲染</span></span><br><span class="line">  goodList.<span class="property">value</span> = res.<span class="property">result</span>.<span class="property">items</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getGoodList</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>使用 Element-plus 提供的 v-infinite-scroll 指令监听是否满足触底条件，满足加载条件时让页数参数加一获取下一页数据，做新老数据拼接渲染。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">        <span class="keyword">class</span>=<span class="string">&quot;body&quot;</span></span><br><span class="line"><span class="comment">//Element-Plus自定义指令，触底就触发事件load，定义load事件写业务逻辑</span></span><br><span class="line">        v-infinite-scroll=<span class="string">&quot;load&quot;</span></span><br><span class="line"><span class="comment">//根据disabled的值来决定是否停止监听，当后端数据加载完毕，就将disabled只改为true，停止监听</span></span><br><span class="line">        :infinite-scroll-disabled=<span class="string">&quot;disabled&quot;</span></span><br><span class="line">      &gt;</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">GoodsItem</span> <span class="attr">v-for</span>=<span class="string">&quot;goods in goodList&quot;</span> <span class="attr">:goods</span>=<span class="string">&quot;goods&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;goods.id&quot;</span> /&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载更多</span></span><br><span class="line"><span class="keyword">const</span> disabled = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">load</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 获取下一页的数据</span></span><br><span class="line">  repData.<span class="property">value</span>.<span class="property">page</span>++;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getSubCategoryAPI</span>(repData.<span class="property">value</span>);</span><br><span class="line">  <span class="comment">//做新老数据拼接操作，组件同步更新</span></span><br><span class="line">  goodList.<span class="property">value</span> = [...goodList.<span class="property">value</span>, ...res.<span class="property">result</span>.<span class="property">items</span>];</span><br><span class="line">  <span class="comment">//当获取过来的商品数组为空时， 加载完毕 停止监听</span></span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">result</span>.<span class="property">items</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    disabled.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="定制路由行为"><a href="#定制路由行为" class="headerlink" title="定制路由行为"></a>定制路由行为</h2><p>在不同路由切换的时候，可以自动滚动到页面的顶部，而不是停留在原先的位置。</p>
<p>vue-router支持scrollBehavior配置项，可以指定路由切换时的滚动位置。在router实例文件中配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//路由滚动行为定制</span></span><br><span class="line"><span class="attr">router</span>:[...]  ,</span><br><span class="line"><span class="title function_">scrollBehavior</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">top</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="空对象多层属性访问报错"><a href="#空对象多层属性访问报错" class="headerlink" title="空对象多层属性访问报错"></a>空对象多层属性访问报错</h2><p>goods一开始是空对象，.categories[1]就是undefined</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-breadcrumb-item :to=<span class="string">&quot;&#123; path: `/category/sub/$&#123;goods.categories[1].id&#125;` &#125;&quot;</span>&gt;&#123;&#123;goods.<span class="property">categories</span>[<span class="number">1</span>].<span class="property">name</span>&#125;&#125; &lt;/el-breadcrumb-item&gt;</span><br></pre></td></tr></table></figure>

<p>如何解决？</p>
<p>1、可选链语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-breadcrumb-item :to=<span class="string">&quot;&#123; path: `/category/sub/$&#123;goods.categories?.[1].id&#125;` &#125;&quot;</span>&gt;&#123;&#123;goods.<span class="property">categories</span>[<span class="number">1</span>].<span class="property">name</span>&#125;&#125; &lt;/el-breadcrumb-item&gt;</span><br></pre></td></tr></table></figure>

<p>2、v-if手动控制渲染时机，保证只有数据存在才渲染</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;container&quot;</span> v-<span class="keyword">if</span>=<span class="string">&quot;goods.detail&quot;</span>&gt;</span><br><span class="line">...</span><br><span class="line">(在外层盒子加一个<span class="keyword">if</span>判断语句，如果goods数据存在，则为真，才会进行后面的渲染)</span><br></pre></td></tr></table></figure>

<h2 id="登录表单校验-element-plus的form组件"><a href="#登录表单校验-element-plus的form组件" class="headerlink" title="登录表单校验-element-plus的form组件"></a>登录表单校验-element-plus的form组件</h2><p>定义表单和规则：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表单对象</span></span><br><span class="line"><span class="keyword">const</span> form = <span class="title function_">ref</span>(&#123;</span><br><span class="line">  <span class="attr">account</span>: <span class="string">&quot;12056258282&quot;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&quot;hm#qd@23!&quot;</span>,</span><br><span class="line">  <span class="attr">agree</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 规则数据对象</span></span><br><span class="line"><span class="keyword">const</span> rules = &#123;</span><br><span class="line">  <span class="attr">account</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;用户名不能为空&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;],</span><br><span class="line">  <span class="comment">//trigger为鼠标失去焦点时触发</span></span><br><span class="line">  <span class="attr">password</span>: [</span><br><span class="line">    &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;密码不能为空&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">min</span>: <span class="number">6</span>, <span class="attr">max</span>: <span class="number">24</span>, <span class="attr">message</span>: <span class="string">&quot;密码长度要求6-14个字符&quot;</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">agree</span>: [</span><br><span class="line">    &#123;<span class="comment">//自定义表单规则</span></span><br><span class="line">      <span class="attr">validator</span>: <span class="function">(<span class="params">rule, val, callback</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">        <span class="keyword">return</span> val ? <span class="title function_">callback</span>() : <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;请先同意协议&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>表单统一校验：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取form实例做统一校验</span></span><br><span class="line"><span class="keyword">const</span> formRef = <span class="title function_">ref</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">doLogin</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  formRef.<span class="property">value</span>.<span class="title function_">validate</span>( <span class="function">(<span class="params">vaild</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//vaild表示所有表单都通过校验才为true</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(vaild);</span><br><span class="line">    <span class="keyword">if</span> (vaild) &#123;</span><br><span class="line">  <span class="comment">//其他逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="按需导入样式"><a href="#按需导入样式" class="headerlink" title="按需导入样式"></a>按需导入样式</h2><p>如果使用 <code>unplugin-element-plus</code> 并且只使用组件 API，你需要手动导入样式。</p>
<p>Example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;element-plus/theme-chalk/el-message.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="持久化用户数据"><a href="#持久化用户数据" class="headerlink" title="持久化用户数据"></a>持久化用户数据</h2><p>插件安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pinia-plugin-persistedstate</span><br></pre></td></tr></table></figure>

<p>将插件添加到 pinia 实例上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createPinia &#125; from &#x27;pinia&#x27;</span><br><span class="line">import piniaPluginPersistedstate from &#x27;pinia-plugin-persistedstate&#x27;</span><br><span class="line"></span><br><span class="line">const pinia = createPinia()</span><br><span class="line">pinia.use(piniaPluginPersistedstate)</span><br></pre></td></tr></table></figure>

<p>创建 Store 时，将 <code>persist</code> 选项设置为 <code>true</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">  <span class="comment">// 1. 定义管理用户数据的state</span></span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;&#125;</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123; <span class="comment">// 2. 定义获取接口数据的action函数</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getUserInfo</span>(<span class="params">&#123; account, password &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">loginAPI</span>(&#123; account, password &#125;)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">userInfo</span> = res.<span class="property">result</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取用户数据出错&#x27;</span>, e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">persist</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>（一开始本地存储无效，因为persist位置写错了）</p>
<p>运行机制：在设置state的时候会自动把数据同步给localstorage，在获取state数据的时候会优先从localstorage中获取。</p>
<p>如何存储登录用户数据？（刷新后还在）</p>
<p>思路：判断验证用户身份的token是否存在，如果存在则调用有用户信息的组件；否则调用请登录的组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;template v-<span class="keyword">if</span>=<span class="string">&quot;userStore.userInfo.token&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="请求拦截器携带Token"><a href="#请求拦截器携带Token" class="headerlink" title="请求拦截器携带Token"></a>请求拦截器携带Token</h2><p>请求拦截器可以在接口正式发起之前对请求参数做一些事情，通常token数据会被注入到请求header中，格式按照后端要求的格式进行拼接处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// axios请求拦截器</span></span><br><span class="line">httpInstance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//从pinia里面获取token数据</span></span><br><span class="line">  <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">  <span class="keyword">const</span> token = userStore.<span class="property">userInfo</span>.<span class="property">token</span></span><br><span class="line">  <span class="comment">//拼接token数据</span></span><br><span class="line">  <span class="keyword">if</span> (token) &#123;</span><br><span class="line">    config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;, <span class="function"><span class="params">e</span> =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(e))</span><br></pre></td></tr></table></figure>

<h2 id="路由跳转问题"><a href="#路由跳转问题" class="headerlink" title="路由跳转问题"></a>路由跳转问题</h2><p>useRouter只能在组件内使用，要在独立的js文件或ts文件不能使用useRouter获取？</p>
<h2 id="地址切换交互-tab切换交互"><a href="#地址切换交互-tab切换交互" class="headerlink" title="地址切换交互-tab切换交互"></a>地址切换交互-tab切换交互</h2><p>1、打开弹框交互：点击切换地址按钮，打开弹框，回显用户可选地址列表；</p>
<p>2、切换地址交互：点击切换地址，点击确定按钮，激活地址替换默认收货地址。</p>
<p>2：点击时记录当前激活地址对象activeAddress，点击哪个地址就把哪个地址对象记录下来；</p>
<p>通过动态类名：class控制激活样式类型active是否存在，判断条件：激活地址对象的id&#x3D;&#x3D;&#x3D;当前项id。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 切换地址 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">v-model</span>=<span class="string">&quot;showDialog&quot;</span> <span class="attr">title</span>=<span class="string">&quot;切换收货地址&quot;</span> <span class="attr">width</span>=<span class="string">&quot;30%&quot;</span> <span class="attr">center</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;addressWrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">click</span>=<span class="string">&quot;switchAddress(item)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">class</span>=<span class="string">&quot;text item&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:class</span>=<span class="string">&quot;&#123; active: activeAddress.id === item.id &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-for</span>=<span class="string">&quot;item in checkInfo.userAddresses&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>收<span class="tag">&lt;<span class="name">i</span> /&gt;</span>货<span class="tag">&lt;<span class="name">i</span> /&gt;</span>人：<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#123;&#123; item.receiver &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>联系方式：<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#123;&#123; item.contact &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>收货地址：<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#123;&#123; item.fullLocation + item.address &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;showDialog = false&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;confirm&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>点击确定后将记录的地址传给显示到页面的参数重新渲染：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> checkInfo = <span class="title function_">ref</span>(&#123;&#125;); <span class="comment">// 订单对象</span></span><br><span class="line"><span class="keyword">const</span> defaultAddress = <span class="title function_">ref</span>(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getcheckInfo</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getCheckoutInfoAPI</span>();</span><br><span class="line">  checkInfo.<span class="property">value</span> = res.<span class="property">result</span>;</span><br><span class="line">  <span class="comment">//适配默认地址</span></span><br><span class="line">  <span class="comment">//从地址中选出isDefault===0的那一项</span></span><br><span class="line">  <span class="keyword">const</span> item = checkInfo.<span class="property">value</span>.<span class="property">userAddresses</span>.<span class="title function_">find</span>(</span><br><span class="line">    <span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">isDefault</span> === <span class="number">0</span></span><br><span class="line">  );</span><br><span class="line">  defaultAddress.<span class="property">value</span> = item;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getcheckInfo</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//控制弹框</span></span><br><span class="line"><span class="keyword">const</span> showDialog = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//切换地址</span></span><br><span class="line"><span class="keyword">const</span> activeAddress = <span class="title function_">ref</span>(&#123;&#125;);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">switchAddress</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">  activeAddress.<span class="property">value</span> = item;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//确认按钮</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">confirm</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  defaultAddress.<span class="property">value</span> = activeAddress.<span class="property">value</span>;</span><br><span class="line">  showDialog.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>总结：记录激活项（整个对象&#x2F;id…）+动态类型控制。</p>
<h2 id="支付业务流程"><a href="#支付业务流程" class="headerlink" title="支付业务流程"></a>支付业务流程</h2><p>跳转支付地址（get请求）（订单id+回跳地址url）-&gt;跳转到回跳地址url（订单id+支付状态）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跳转支付</span></span><br><span class="line"><span class="comment">//携带订单id以及回调地址跳转到支付地址（get）</span></span><br><span class="line"><span class="comment">// 支付地址</span></span><br><span class="line"><span class="keyword">const</span> baseURL = <span class="string">&quot;http://pcapi-xiaotuxian-front-devtest.itheima.net/&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> backURL = <span class="string">&quot;http://localhost:5173/paycallback&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> redirectUrl = <span class="built_in">encodeURIComponent</span>(backURL);</span><br><span class="line"><span class="keyword">const</span> payUrl = <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>pay/aliPay?orderId=<span class="subst">$&#123;route.query.id&#125;</span>&amp;redirect=<span class="subst">$&#123;redirectUrl&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span><br><span class="line">         <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>支付平台<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">         <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn wx&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">         <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn alipay&quot;</span> <span class="attr">:href</span>=<span class="string">&quot;payUrl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">       &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>跳转到支付页面后输入账号密码支付密码即可，后面是后端的工作。</p>
<p>页面最后会自动跳转回backURL地址，所以要配置对应的路由以及页面组件。页面效果展示支付成功还是失败，以及一些订单信息。</p>
<p>获取订单信息调用接口：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getOrderAPI</span> = (<span class="params">id</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/member/order/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取订单信息</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getOrderInfo</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getOrderAPI</span>(route.<span class="property">query</span>.<span class="property">orderId</span>);</span><br><span class="line">  orderInfo.<span class="property">value</span> = res.<span class="property">result</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getOrderInfo</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="支付倒计时实现"><a href="#支付倒计时实现" class="headerlink" title="支付倒计时实现"></a>支付倒计时实现</h3><p>因为接口给的时间参数是秒数，要写一个函数可以把秒数格式化为倒计时的显示状态。</p>
<p>安装一个格式化的插件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i dayjs</span><br></pre></td></tr></table></figure>

<p>函数封装：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed, onUnmounted, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//封装倒计时逻辑函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useCountDown</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">//1、响应式数据</span></span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">const</span> time = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="comment">//格式化时间-xx分xx秒</span></span><br><span class="line">  <span class="keyword">const</span> formatTime = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> dayjs.<span class="title function_">unix</span>(time.<span class="property">value</span>).<span class="title function_">format</span>(<span class="string">&#x27;mm分ss秒&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//2、开启倒计时函数</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">start</span> = (<span class="params">currentTime</span>) =&gt; &#123;</span><br><span class="line">    time.<span class="property">value</span> = currentTime</span><br><span class="line">    timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      time.<span class="property">value</span>--</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//组件销毁时清除定时器</span></span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    timer &amp;&amp; <span class="built_in">clearInterval</span>(timer)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    formatTime,</span><br><span class="line">    start</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>组件调用函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCountDown &#125; <span class="keyword">from</span> <span class="string">&quot;@/composables/useCountDown&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//倒计时实现</span></span><br><span class="line"><span class="keyword">const</span> &#123; formatTime, start &#125; = <span class="title function_">useCountDown</span>();</span><br><span class="line"><span class="comment">//获取订单数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getPayInfo</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getOrderAPI</span>(route.<span class="property">query</span>.<span class="property">id</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;支付数据&quot;</span>, res);</span><br><span class="line">  payInfo.<span class="property">value</span> = res.<span class="property">result</span>;</span><br><span class="line">  <span class="comment">//初始化倒计时秒数</span></span><br><span class="line">  <span class="title function_">start</span>(res.<span class="property">result</span>.<span class="property">countdown</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://lianguaing.github.io">hx桦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://lianguaing.github.io/2024/02/20/vue3%E9%A1%B9%E7%9B%AE/">https://lianguaing.github.io/2024/02/20/vue3%E9%A1%B9%E7%9B%AE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lianguaing.github.io" target="_blank">Luax的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/">项目笔记</a></div><div class="post_share"><div class="social-share" data-image="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/14.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/02/21/Pinia%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98/" title="Pinia状态管理实现数据同步问题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/15.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Pinia状态管理实现数据同步问题</div></div></a></div><div class="next-post pull-right"><a href="/2024/02/15/Map%E5%AF%B9%E8%B1%A1/" title="Map对象"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/4.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Map对象</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/02/21/Pinia%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98/" title="Pinia状态管理实现数据同步问题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/15.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-21</div><div class="title">Pinia状态管理实现数据同步问题</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">hx桦</div><div class="author-info__description">顺遂无虞，皆得所愿</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lianguaing"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my blog,sharing some learning experiences and notes.Happy to discuss academic matters with you!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#vue%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">vue项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.</span> <span class="toc-text">组件分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%A2%98%E8%89%B2%E5%AE%9A%E5%88%B6-sass%E5%BC%95%E5%85%A5"><span class="toc-number">1.2.</span> <span class="toc-text">主题色定制-sass引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#axios%E5%AE%9E%E4%BE%8B%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">axios实例化配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%B8%E9%A1%B6%E4%BA%A4%E4%BA%92"><span class="toc-number">1.4.</span> <span class="toc-text">吸顶交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pinia%E4%BC%98%E5%8C%96%E9%87%8D%E5%A4%8D%E8%AF%B7%E6%B1%82"><span class="toc-number">1.5.</span> <span class="toc-text">Pinia优化重复请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E9%97%AE%E9%A2%98"><span class="toc-number">1.6.</span> <span class="toc-text">组件封装(数据传输问题)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.7.</span> <span class="toc-text">实现图片懒加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%87%92%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.8.</span> <span class="toc-text">懒加载优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%A1%B5%E4%B8%80%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="toc-number">1.9.</span> <span class="toc-text">主页一级分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-number">1.10.</span> <span class="toc-text">路由缓存问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9A%E7%BB%99router-view%E6%B7%BB%E5%8A%A0key"><span class="toc-number">1.10.1.</span> <span class="toc-text">方案一：给router-view添加key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8beforeRouterUpdate%E5%AF%BC%E8%88%AA%E9%92%A9%E5%AD%90"><span class="toc-number">1.10.2.</span> <span class="toc-text">方案二：使用beforeRouterUpdate导航钩子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%8B%86%E5%88%86"><span class="toc-number">1.11.</span> <span class="toc-text">逻辑拆分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%97%A0%E9%99%90%E5%8A%A0%E8%BD%BD%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.12.</span> <span class="toc-text">列表无限加载功能实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E8%B7%AF%E7%94%B1%E8%A1%8C%E4%B8%BA"><span class="toc-number">1.13.</span> <span class="toc-text">定制路由行为</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E5%AF%B9%E8%B1%A1%E5%A4%9A%E5%B1%82%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE%E6%8A%A5%E9%94%99"><span class="toc-number">1.14.</span> <span class="toc-text">空对象多层属性访问报错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C-element-plus%E7%9A%84form%E7%BB%84%E4%BB%B6"><span class="toc-number">1.15.</span> <span class="toc-text">登录表单校验-element-plus的form组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E9%9C%80%E5%AF%BC%E5%85%A5%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.16.</span> <span class="toc-text">按需导入样式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE"><span class="toc-number">1.17.</span> <span class="toc-text">持久化用户数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA%E5%99%A8%E6%90%BA%E5%B8%A6Token"><span class="toc-number">1.18.</span> <span class="toc-text">请求拦截器携带Token</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC%E9%97%AE%E9%A2%98"><span class="toc-number">1.19.</span> <span class="toc-text">路由跳转问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%88%87%E6%8D%A2%E4%BA%A4%E4%BA%92-tab%E5%88%87%E6%8D%A2%E4%BA%A4%E4%BA%92"><span class="toc-number">1.20.</span> <span class="toc-text">地址切换交互-tab切换交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">1.21.</span> <span class="toc-text">支付业务流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E5%80%92%E8%AE%A1%E6%97%B6%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.21.1.</span> <span class="toc-text">支付倒计时实现</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/02/22/%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81/" title="防抖和节流"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="防抖和节流"/></a><div class="content"><a class="title" href="/2024/02/22/%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81/" title="防抖和节流">防抖和节流</a><time datetime="2024-02-21T16:00:00.000Z" title="发表于 2024-02-22 00:00:00">2024-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/21/Pinia%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98/" title="Pinia状态管理实现数据同步问题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/15.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Pinia状态管理实现数据同步问题"/></a><div class="content"><a class="title" href="/2024/02/21/Pinia%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98/" title="Pinia状态管理实现数据同步问题">Pinia状态管理实现数据同步问题</a><time datetime="2024-02-20T16:00:00.000Z" title="发表于 2024-02-21 00:00:00">2024-02-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/20/vue3%E9%A1%B9%E7%9B%AE/" title="vue项目-问题解决01"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue项目-问题解决01"/></a><div class="content"><a class="title" href="/2024/02/20/vue3%E9%A1%B9%E7%9B%AE/" title="vue项目-问题解决01">vue项目-问题解决01</a><time datetime="2024-02-19T16:00:00.000Z" title="发表于 2024-02-20 00:00:00">2024-02-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/15/Map%E5%AF%B9%E8%B1%A1/" title="Map对象"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Map对象"/></a><div class="content"><a class="title" href="/2024/02/15/Map%E5%AF%B9%E8%B1%A1/" title="Map对象">Map对象</a><time datetime="2024-02-14T16:00:00.000Z" title="发表于 2024-02-15 00:00:00">2024-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/15/%E4%BA%8B%E4%BB%B6%E6%B5%81/" title="js中的事件流"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="js中的事件流"/></a><div class="content"><a class="title" href="/2024/02/15/%E4%BA%8B%E4%BB%B6%E6%B5%81/" title="js中的事件流">js中的事件流</a><time datetime="2024-02-14T16:00:00.000Z" title="发表于 2024-02-15 00:00:00">2024-02-15</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://hx-blog.oss-cn-shenzhen.aliyuncs.com/blogWallpaper/wallpaper/14.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By hx桦</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi~welcome to my blog~</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="/js/tw_cn.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>